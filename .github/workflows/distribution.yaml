name: Distribution

on:
  workflow_dispatch:

jobs:
  tests:
    uses: polvo-labs/cincominutos-app/.github/workflows/tests.yaml@main

  pre-release:
    needs: tests
    permissions:
      checks: write
      contents: write
      packages: write
    runs-on: [ marcOS ]

    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    - name: Create Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # This token is provided by Actions, you do not need to create your own token
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ github.ref }}
        body: |
          ### O que foi feito?
          - First Change
          - Second Change
        draft: true
        prerelease: true

    distribution:
      needs: pre-release
      uses: polvo-labs/cincominutos-app/.github/workflows/ios_distribution_dev.yaml@main